<view class="container">
    <!-- 页面头部 -->
    <view class="header">
        <!-- 返回按钮 -->
        <view class="header-top">
            <view class="back-btn" bindtap="goBack" hover-class="back-btn-hover">
                <van-icon name="arrow-left" size="36rpx" color="#FFFFFF"/>
                <text class="back-text">返回</text>
            </view>
        </view>

        <view class="header-bg">
            <view class="header-decoration">
                <view class="decoration-circle circle-1"></view>
                <view class="decoration-circle circle-2"></view>
                <view class="decoration-circle circle-3"></view>
            </view>
        </view>
        <view class="header-content">
            <text class="title">养老用餐</text>
            <text class="subtitle">社区养老用餐服务</text>
        </view>
    </view>

    <!-- 温馨提示 -->
    <view class="notice-banner">
        <view class="notice-content">
            <van-icon name="info-o" size="28rpx" color="#FF6B35"/>
            <text class="notice-text">此页面仅为示例展示，即将投入使用</text>
        </view>
    </view>

    <!-- 日期显示 -->
    <view class="menu-date">{{currentDate}} 食谱</view>

    <!-- 社区食谱列表 -->
    <view class="meals-categories">
        <view wx:for="{{communities}}" wx:key="id" class="community-section" wx:for-item="community" wx:for-index="outerIndex">
            <!-- 社区标题 -->
            <view class="community-title">
                <van-icon name="shop-o" size="40rpx" color="#ffffffff"/>
                <text>{{community.name}}</text>
                <view class="navigate-btn" wx:if="{{community.latitude && community.longitude}}" bindtap="navigateToCommunity" data-index="{{outerIndex}}">
                    <van-icon name="location-o" size="28rpx" color="#FFFFFF"/>
                    <text class="navigate-text">导航</text>
                </view>
            </view>

            <!-- 菜单列表 -->
            <view class="menus-list">
                <view wx:for="{{community.menus}}" wx:key="id" class="menu-category">
                    <!-- 菜单展开头 -->
                    <view class="menu-header" bindtap="toggleMenu" data-community-id="{{community.id}}" data-menu-id="{{item.id}}">
                        <view class="menu-icon">
                            <van-icon name="star-o" size="32rpx" color="#ffffff"/>
                        </view>
                        <view class="menu-info">
                            <text class="menu-title">{{item.title}}</text>
                            <text class="menu-desc">{{item.desc}}</text>
                        </view>
                        <view class="expand-icon" wx:if="{{!item.expanded}}">
                            <van-icon name="arrow" size="28rpx" color="#FF6B35"/>
                        </view>
                        <view class="expand-icon" wx:else>
                            <van-icon name="arrow-down" size="28rpx" color="#FF6B35"/>
                        </view>
                    </view>

                    <!-- 菜单内容 -->
                    <view class="menu-content" wx:if="{{item.expanded}}">
                        <image 
                            src="{{item.image}}" 
                            class="menu-image" 
                            mode="aspectFit"
                            bindtap="viewImage" 
                            data-image="{{item.image}}" 
                            data-title="{{item.title}}" 
                        />
                    </view>
                </view>
            </view>

            <!-- 就餐信息 - 仅在通用芳华社区显示 -->
            <view wx:if="{{community.info}}" class="info-section">
                <view wx:for="{{community.info}}" wx:key="id" class="info-card">
                    <!-- 信息卡头部 -->
                    <view class="info-header" bindtap="toggleInfo" data-community-id="{{community.id}}" data-info-id="{{item.id}}">
                        <view class="info-icon">
                            <van-icon name="{{item.icon}}" size="28rpx" color="#ffffff"/>
                        </view>
                        <view class="info-header-content">
                            <text class="info-title">{{item.title}}</text>
                        </view>
                        <view class="expand-icon" wx:if="{{!item.expanded}}">
                            <van-icon name="arrow" size="24rpx" color="#FF6B35"/>
                        </view>
                        <view class="expand-icon" wx:else>
                            <van-icon name="arrow-down" size="24rpx" color="#FF6B35"/>
                        </view>
                    </view>

                    <!-- 信息卡内容 -->
                    <view class="info-content" wx:if="{{item.expanded}}">
                        <text class="info-text">{{item.content}}</text>
                    </view>
                </view>
            </view>
        </view>
    </view>

    <!-- 分类提示 -->
    <view class="category-tip" wx:if="{{!showImageViewer}}">
        <van-icon name="info-o" size="28rpx" color="#FF6B35"/>
        <text class="tip-text">点击菜单分类可展开查看详细食谱</text>
    </view>

    <!-- 图片预览 -->
    <view class="image-viewer" wx:if="{{showImageViewer}}">
        <!-- 返回按钮 - 固定在左上方 -->
        <view class="close-btn" bindtap="closeImageViewer">
            <van-icon name="arrow-left" size="32rpx" color="white"/>
        </view>
        
        <!-- 顶部信息 -->
        <view class="viewer-header">
            <view class="viewer-title">{{currentImageTitle}}</view>
        </view>
        
        <!-- 中间图片容器 - 自适应居中 -->
        <view class="viewer-content">
            <image 
                src="{{currentImage}}"
                mode="aspectFit"
                class="viewer-image-box"
                style="transform: scale({{scale}}) translate({{translateX}}px, {{translateY}}px);"
                bindtouchstart="onTouchStart"
                bindtouchmove="onTouchMove"
                bindtouchend="onTouchEnd"
                bindtouchcancel="onTouchEnd"
            />
        </view>
        
        <!-- 底部控制栏 -->
        <view class="viewer-bottom">
            <view class="zoom-text">{{zoomPercent}}%</view>
            <view class="pinch-tip">
                <van-icon name="info-o" size="24rpx" color="#FF6B35"/>
                <text class="tip-label">双指拖拽可缩放</text>
            </view>
        </view>
    </view>
</view>
