<view class="container">
    <!-- 页面头部 -->
    <view class="header">
        <view class="header-bg">
            <view class="header-decoration">
                <view class="decoration-circle circle-1"></view>
                <view class="decoration-circle circle-2"></view>
                <view class="decoration-circle circle-3"></view>
            </view>
        </view>
        <view class="header-content">
            <text class="title">政策法规</text>
            <text class="subtitle">查看相关政策文件</text>
        </view>
    </view>

    <!-- 政策分类列表 -->
    <view class="policy-categories">
        <!-- 养老照护床位政策 -->
        <view class="category-section">
            <view class="category-header" bindtap="toggleCategory" data-category="care">
                <view class="category-icon">
                    <van-icon name="hotel-o" size="40rpx" color="#ffffffff"/>
                </view>
                <view class="category-info">
                    <text class="category-title">养老照护床位政策</text>
                    <text class="category-desc">家庭照护床位相关政策文件</text>
                </view>
                <view class="expand-icon" wx:if="{{!expandedCategories.care}}">
                    <van-icon name="arrow" size="28rpx" color="#FF6B35"/>
                </view>
                <view class="expand-icon" wx:else>
                    <van-icon name="arrow-down" size="28rpx" color="#FF6B35"/>
                </view>
            </view>

            <view class="category-content" wx:if="{{expandedCategories.care}}">
                <view class="policy-item" wx:for="{{carePolicies}}" wx:key="id" bindtap="viewPdfImages" data-file="{{item.file}}" data-title="{{item.title}}" data-pages="{{item.totalPages}}">
                    <view class="item-icon">
                        <van-icon name="description" size="24rpx" color="#FF8C42"/>
                    </view>
                    <view class="item-content">
                        <text class="item-title">{{item.title}}</text>
                        <text class="item-desc">{{item.desc}} ({{item.totalPages}}页)</text>
                    </view>
                    <view class="item-arrow">
                        <van-icon name="arrow" size="20rpx" color="#999"/>
                    </view>
                </view>
            </view>
        </view>

        <!-- 老年人能力评估政策 -->
        <view class="category-section">
            <view class="category-header" bindtap="toggleCategory" data-category="assessment">
                <view class="category-icon">
                    <van-icon name="orders-o" size="40rpx" color="#ffffffff"/>
                </view>
                <view class="category-info">
                    <text class="category-title">老年人能力评估政策</text>
                    <text class="category-desc">老年人能力评估相关政策文件</text>
                </view>
                <view class="expand-icon" wx:if="{{!expandedCategories.assessment}}">
                    <van-icon name="arrow" size="28rpx" color="#FF6B35"/>
                </view>
                <view class="expand-icon" wx:else>
                    <van-icon name="arrow-down" size="28rpx" color="#FF6B35"/>
                </view>
            </view>

            <view class="category-content" wx:if="{{expandedCategories.assessment}}">
                <view class="policy-item" wx:for="{{assessmentPolicies}}" wx:key="id" bindtap="viewPdfImages" data-file="{{item.file}}" data-title="{{item.title}}" data-pages="{{item.totalPages}}">
                    <view class="item-icon">
                        <van-icon name="description" size="24rpx" color="#FF8C42"/>
                    </view>
                    <view class="item-content">
                        <text class="item-title">{{item.title}}</text>
                        <text class="item-desc">{{item.desc}} ({{item.totalPages}}页)</text>
                    </view>
                    <view class="item-arrow">
                        <van-icon name="arrow" size="20rpx" color="#999"/>
                    </view>
                </view>
            </view>
        </view>

        <!-- 老年人福利政策 -->
        <view class="category-section">
            <view class="category-header" bindtap="toggleCategory" data-category="welfare">
                <view class="category-icon">
                    <van-icon name="gift-o" size="40rpx" color="#ffffffff"/>
                </view>
                <view class="category-info">
                    <text class="category-title">老年人福利政策</text>
                    <text class="category-desc">老年人福利补贴和服务相关政策文件</text>
                </view>
                <view class="expand-icon" wx:if="{{!expandedCategories.welfare}}">
                    <van-icon name="arrow" size="28rpx" color="#FF6B35"/>
                </view>
                <view class="expand-icon" wx:else>
                    <van-icon name="arrow-down" size="28rpx" color="#FF6B35"/>
                </view>
            </view>

            <view class="category-content" wx:if="{{expandedCategories.welfare}}">
                <view class="policy-item" wx:for="{{welfarePolicies}}" wx:key="id" bindtap="viewPdfImages" data-file="{{item.file}}" data-title="{{item.title}}" data-pages="{{item.totalPages}}">
                    <view class="item-icon">
                        <van-icon name="description" size="24rpx" color="#FF8C42"/>
                    </view>
                    <view class="item-content">
                        <text class="item-title">{{item.title}}</text>
                        <text class="item-desc">{{item.desc}} ({{item.totalPages}}页)</text>
                    </view>
                    <view class="item-arrow">
                        <van-icon name="arrow" size="20rpx" color="#999"/>
                    </view>
                </view>
            </view>
        </view>
    </view>

    <!-- 分类提示 -->
    <view class="category-tip" wx:if="{{!showImageViewer}}">
        <van-icon name="info-o" size="28rpx" color="#FF8C42"/>
        <text class="tip-text">点击分类可展开查看相关政策文件</text>
    </view>

    <!-- PDF预览区域 -->
    <view class="image-viewer-overlay" wx:if="{{showImageViewer}}">
        <view class="image-viewer">
            <view class="viewer-header">
                <view class="back-btn" bindtap="closeImageViewer" hover-class="back-btn-hover">
                    <van-icon name="arrow-left" size="36rpx" color="#FFFFFF"/>
                    <text class="back-text">返回目录</text>
                </view>
                <view class="viewer-title-section">
                    <text class="viewer-title">{{currentPdfTitle}}</text>
                    <text class="viewer-page-info">{{loadedPages}}/{{currentPdfTotalPages}}页</text>
                </view>
            </view>

            <scroll-view
                class="viewer-content"
                scroll-y="{{isScrollEnabled}}"
                enhanced="{{true}}"
                fast-deceleration="{{true}}"
                show-scrollbar="{{true}}"
                scroll-with-animation="{{true}}"
                bindscrolltolower="handleScrollToLower"
                bind:touchstart="handleScrollTouchStart"
                bind:touchmove="handleScrollTouchMove"
                bind:touchend="handleScrollTouchEnd"
                bind:touchcancel="handleScrollTouchCancel">
                <view class="image-container">
                    <block wx:for="{{currentImageList}}" wx:key="page">
                        <view class="image-wrapper pdf-page">
                            <view class="page-number">第{{item.page}}页/共{{currentPdfTotalPages}}页</view>
                            <view class="image-zoom-container"
                                bind:touchstart="handleImageTouchStart"
                                bind:touchmove="handleImageTouchMove"
                                bind:touchend="handleImageTouchEnd"
                                bind:touchcancel="handleImageTouchCancel">
                                <image 
                                    class="pdf-image" 
                                    src="{{item.url}}" 
                                    data-index="{{index}}" 
                                    mode="widthFix" 
                                    style="transform: scale({{scale}});"
                                    binderror="handleImageError"
                                    catch:longpress="">
                                </image>
                            </view>
                        </view>
                    </block>
                    
                    <view class="loading-more" wx:if="{{loadedPages < currentPdfTotalPages}}">
                        <van-loading color="#FF6B35" size="24px">加载更多PDF页面...</van-loading>
                    </view>
                    
                    <view class="end-of-document" wx:if="{{loadedPages >= currentPdfTotalPages}}">
                        <text>— PDF文档结束 —</text>
                    </view>
                </view>
            </scroll-view>
            
            <view class="image-controls">
                <view class="scale-info">缩放: {{scaleDisplay}}%</view>
                <view class="zoom-tips">提示: 用两指手势可缩放PDF文档</view>
            </view>
            
            <!-- 移除右下角悬浮返回按钮 -->
        </view>
    </view>
</view>
