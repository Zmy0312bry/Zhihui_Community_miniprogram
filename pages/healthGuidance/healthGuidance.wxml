<view class="container">
    <!-- 页面头部 -->
    <view class="header">
        <!-- 返回按钮 -->
        <view class="header-top">
            <view class="back-btn" bindtap="goBack" hover-class="back-btn-hover">
                <van-icon name="arrow-left" size="36rpx" color="#FFFFFF"/>
                <text class="back-text">返回</text>
            </view>
        </view>

        <view class="header-bg">
            <view class="header-decoration">
                <view class="decoration-circle circle-1"></view>
                <view class="decoration-circle circle-2"></view>
                <view class="decoration-circle circle-3"></view>
            </view>
        </view>
        <view class="header-content">
            <view class="title-section">
                <text class="title">健康指导</text>
                <text class="subtitle">守护您的健康生活</text>
            </view>
        </view>
    </view>

    <!-- 健康指导内容 -->
    <view class="content">
        <!-- 健康知识云课堂 -->
        <view class="video-library-section">
            <view class="section-header">
                <van-icon name="play-circle-o" size="48rpx" color="#FF6B35"/>
                <text class="section-title">健康知识云课堂</text>
            </view>

            <!-- 章节选项卡 -->
            <view class="chapter-tabs">
                <view wx:for="{{videoLibrary.chapters}}" wx:key="id" class="chapter-tab {{selectedChapterIndex === index ? 'active' : ''}}" 
                    bindtap="selectVideoChapter" data-index="{{index}}">
                    <text class="tab-label">{{item.title}}</text>
                </view>
            </view>

            <!-- 课程列表 -->
            <view class="lessons-container">
                <view wx:for="{{videoLibrary.chapters[selectedChapterIndex].lessons}}" wx:key="id" class="lesson-card" 
                    bindtap="selectVideoLesson" data-lesson-id="{{item.id}}" data-lesson-name="{{item.name}}" data-video-url="{{item.videoUrl}}">
                    <view class="lesson-header">
                        <view class="lesson-icon">
                            <van-icon name="play" size="32rpx" color="#FF6B35"/>
                        </view>
                        <view class="lesson-info">
                            <text class="lesson-name">{{item.name}}</text>
                            <text class="lesson-duration">时长：{{item.duration}}</text>
                        </view>
                        <van-icon name="arrow" size="28rpx" color="#FF6B35"/>
                    </view>
                </view>
            </view>
        </view>

        <!-- 心肺复苏指导 -->
        <view class="cpr-section">
            <view class="section-header">
                <van-icon name="certificate" size="48rpx" color="#FF6B35"/>
                <text class="section-title">心肺复苏指导</text>
            </view>
            
            <!-- CPR 类型选项卡 -->
            <view class="cpr-tabs">
                <view wx:for="{{cprTypes}}" wx:key="id" class="cpr-tab {{selectedCPRIndex === index ? 'active' : ''}}" 
                    bindtap="selectCPRType" data-index="{{index}}">
                    <text class="tab-label">{{item.title}}</text>
                </view>
            </view>
            
            <!-- CPR 图片卡片 - 选中后显示 -->
            <view class="cpr-card-display">
                <view class="cpr-image-container" bindtap="viewSelectedCPRImage">
                    <image src="{{cprTypes[selectedCPRIndex].image}}" class="cpr-image" mode="aspectFit" />
                    <view class="image-overlay">
                        <van-icon name="enlarge" size="48rpx" color="#FF6B35"/>
                        <text class="overlay-text">点击查看大图</text>
                    </view>
                </view>
                <view class="cpr-info">
                    <text class="cpr-title">{{cprTypes[selectedCPRIndex].title}}</text>
                    <text class="cpr-desc">{{cprTypes[selectedCPRIndex].desc}}</text>
                </view>
            </view>
        </view>

        <!-- 阿尔茨海默症科普与预防 -->
        <view class="alzheimer-section">
            <view class="section-header">
                <van-icon name="orders-o" size="48rpx" color="#FF6B35"/>
                <text class="section-title">阿尔茨海默症的科普与预防</text>
            </view>
            <view class="alzheimer-card" bindtap="viewAlzheimerSlides">
                <view class="alzheimer-icon">
                    <van-icon name="description" size="60rpx" color="#ffffffff"/>
                </view>
                <view class="alzheimer-info">
                    <text class="alzheimer-title">阿尔茨海默症科普与预防指南</text>
                    <text class="alzheimer-desc">包含24页详细的科普内容和预防建议</text>
                    <view class="alzheimer-meta">
                        <text class="meta-text">共{{alzheimerData.totalSlides}}页</text>
                        <van-icon name="arrow" size="24rpx" color="#FF6B35"/>
                    </view>
                </view>
            </view>
        </view>
    </view>

    <!-- 视频播放器 -->
    <view class="video-player-overlay" wx:if="{{showVideoPlayer}}" bindtap="closeVideoPlayer">
        <view class="video-player" catchtap>
            <!-- 返回按钮 -->
            <view class="player-close-btn" bindtap="closeVideoPlayer">
                <van-icon name="close" size="36rpx" color="white"/>
            </view>

            <!-- 加载状态 -->
            <view class="video-loading" wx:if="{{videoLoading}}">
                <van-loading type="circular" color="#FF6B35" />
                <text class="loading-text">视频加载中...</text>
            </view>

            <!-- 视频播放区域 -->
            <video 
                id="videoPlayer"
                src="{{currentVideoUrl}}"
                controls
                enable-progress-gesture
                auto-pause-if-navigate
                show-center-play-btn
                object-fit="contain"
                bindloadedmetadata="onVideoLoadedMetadata"
                bindloadeddata="onVideoLoadedData"
                binderror="onVideoError"
                bindplay="onVideoPlay"
                bindpause="onVideoPause"
                class="video-element"
            />
            
            <!-- 视频标题 -->
            <view class="video-title-bar">
                <text class="video-title">{{currentVideoTitle}}</text>
            </view>
        </view>
    </view>

    <!-- 心肺复苏图片预览 -->
    <view class="image-viewer" wx:if="{{showImageViewer}}" bindtap="closeImageViewer">
        <image
            src="{{currentImage}}"
            class="viewer-image"
            mode="aspectFit"
            style="transform: scale({{scale}}) translate({{cprTranslateX}}px, {{cprTranslateY}}px);"
            catchtap="preventClose"
            bindtouchstart="onCPRTouchStart"
            bindtouchmove="onCPRTouchMove"
            bindtouchend="onCPRTouchEnd"
            bindtouchcancel="onCPRTouchEnd"
        />
        <view class="viewer-title">{{currentImageTitle}}</view>
        <view class="zoom-text" catchtap="preventClose">{{zoomPercent}}%</view>
    </view>

    <!-- 阿尔茨海默症幻灯片预览 -->
    <view class="alzheimer-viewer" wx:if="{{showAlzheimerViewer}}" bindtap="closeAlzheimerViewer">
        <view class="alzheimer-viewer-header">
            <view class="back-btn" bindtap="closeAlzheimerViewer" hover-class="back-btn-hover">
                <van-icon name="arrow-left" size="36rpx" color="#FFFFFF"/>
                <text class="back-text">返回</text>
            </view>
            <view class="viewer-title-section">
                <text class="viewer-title">{{alzheimerData.title}}</text>
                <text class="viewer-page-info">{{alzheimerCurrentSlide}}/{{alzheimerData.totalSlides}}</text>
            </view>
        </view>

        <view class="alzheimer-viewer-content" catchtap="preventClose">
            <!-- 左箭头按钮 -->
            <button class="nav-btn nav-prev" catchtap="prevSlide" disabled="{{alzheimerCurrentSlide <= 1}}">
                <van-icon name="arrow-left" size="48rpx" color="{{alzheimerCurrentSlide <= 1 ? '#ccc' : '#FF6B35'}}"/>
            </button>

            <!-- 图片容器 -->
            <image
                src="{{alzheimerData.slides[alzheimerCurrentSlide-1].image}}"
                class="alzheimer-image"
                mode="aspectFit"
                style="transform: scale({{alzheimerScale}}) translate({{alzheimerTranslateX}}px, {{alzheimerTranslateY}}px);"
                catchtap="preventClose"
                bindtouchstart="onAlzheimerTouchStart"
                bindtouchmove="onAlzheimerTouchMove"
                bindtouchend="onAlzheimerTouchEnd"
                bindtouchcancel="onAlzheimerTouchEnd"
            />

            <!-- 右箭头按钮 -->
            <button class="nav-btn nav-next" catchtap="nextSlide" disabled="{{alzheimerCurrentSlide >= alzheimerData.totalSlides}}">
                <van-icon name="arrow" size="48rpx" color="{{alzheimerCurrentSlide >= alzheimerData.totalSlides ? '#ccc' : '#FF6B35'}}"/>
            </button>

            <!-- 缩放提示 -->
            <view class="alzheimer-pinch-tip" wx:if="{{showAlzheimerViewer}}" catchtap="preventClose">
                <van-icon name="info-o" size="24rpx" color="#FF6B35"/>
                <text class="tip-label">双指拖拽可缩放</text>
            </view>
        </view>

        <view class="alzheimer-controls" catchtap="preventClose">
            <view class="zoom-text">{{alzheimerZoomPercent}}%</view>
        </view>
    </view>
</view>
